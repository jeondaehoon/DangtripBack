<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.freefit.freefitapp.hospital.dao.hospitalDao">

    <resultMap id="hospitalMap" type="com.freefit.freefitapp.vo.HospitalVO">
        <result column="ID" property="id" />
        <result column="NAME" property="name" />
        <result column="TAG" property="tag" />
        <result column="RATING" property="rating" />
        <result column="ADDRESS" property="address" />
        <result column="OPENING_HOURS" property="openingHours" />
        <result column="PHONE" property="phone" />
        <result column="EMERGENCY_YN" property="emergencyYn" />
        <result column="LAT" property="lat" />
        <result column="LON" property="lon" />
        <result column="CREATED_AT" property="createdAt" />
        <result column="IMAGE_URL" property="imageUrl" />
    </resultMap>

    <select id="selectNearHospital" resultMap="hospitalMap">
        <![CDATA[
        SELECT ID,
               NAME,
               TAG,
               RATING,
               ADDRESS,
               OPENING_HOURS,
               PHONE,
               EMERGENCY_YN,
               LAT,
               LON,
               CREATED_AT,
               IMAGE_URL,
               6371 * ACOS(
                       COS(LAT * (3.141592653589793/180)) *
                       COS(#{lat} * (3.141592653589793/180)) *
                       COS((#{lon} * (3.141592653589793/180)) - (LON * (3.141592653589793/180))) +
                       SIN(LAT * (3.141592653589793/180)) *
                       SIN(#{lat} * (3.141592653589793/180))
                      ) AS DISTANCE_CALC
        FROM hospital
        WHERE 6371 * ACOS(
                COS(LAT * (3.141592653589793/180)) *
                COS(#{lat} * (3.141592653589793/180)) *
                COS((#{lon} * (3.141592653589793/180)) - (LON * (3.141592653589793/180))) +
                SIN(LAT * (3.141592653589793/180)) *
                SIN(#{lat} * (3.141592653589793/180))
                     ) <= 5
        ORDER BY DISTANCE_CALC ASC
        ]]>
    </select>

    <select id="selectPopularHospital" resultMap="hospitalMap">
        SELECT
            ID,
            NAME,
            TAG,
            RATING,
            ADDRESS,
            OPENING_HOURS,
            PHONE,
            EMERGENCY_YN,
            LAT,
            LON,
            CREATED_AT,
            IMAGE_URL
        FROM HOSPITAL
        WHERE TAG = '추천/인기'
        ORDER BY CREATED_AT DESC
    </select>

    <select id="selectSpecialHospital" resultMap="hospitalMap">
        SELECT
            ID,
            NAME,
            TAG,
            RATING,
            ADDRESS,
            OPENING_HOURS,
            PHONE,
            EMERGENCY_YN,
            LAT,
            LON,
            CREATED_AT,
            IMAGE_URL
        FROM HOSPITAL
        WHERE TAG = '전문 진료'
        ORDER BY CREATED_AT DESC
    </select>

    <select id="select24HoursHospital" resultMap="hospitalMap">
        SELECT
            ID,
            NAME,
            TAG,
            RATING,
            ADDRESS,
            OPENING_HOURS,
            PHONE,
            EMERGENCY_YN,
            LAT,
            LON,
            CREATED_AT,
            IMAGE_URL
        FROM HOSPITAL
        WHERE TAG = '24시간 운영'
        ORDER BY CREATED_AT DESC
    </select>

    <select id="selectHospitalDetail" resultMap="hospitalMap">
        SELECT
            ID,
            NAME,
            TAG,
            RATING,
            ADDRESS,
            OPENING_HOURS,
            PHONE,
            EMERGENCY_YN,
            LAT,
            LON,
            CREATED_AT,
            IMAGE_URL
        FROM HOSPITAL
        WHERE ID = #{id}
    </select>
</mapper>
